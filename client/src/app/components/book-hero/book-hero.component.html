<section
  *ngIf="book"
  class="w-full bg-[var(--color-background-light)] py-12 px-4 sm:px-8 md:px-16 flex flex-col md:flex-row items-center justify-evenly gap-12"
>
  <div
    class="flex-shrink-0 w-56 h-80 sm:w-64 sm:h-96 md:w-72 md:h-[28rem] shadow-lg rounded-lg overflow-hidden bg-[var(--color-background-medium)] flex items-center justify-center"
  >
    <div
      class="transition-transform duration-500 hover:scale-105 hover:shadow-2xl w-full h-full"
    >
      <img
        [src]="book.image"
        [alt]="book.title"
        class="object-cover w-full h-full"
      />
    </div>
  </div>

  <div
    class="flex-1 flex flex-col gap-6 items-center md:items-start w-full max-w-2xl"
  >
    <div class="w-full">
      <div
        class="text-xs font-medium text-[var(--color-text-muted)] italic mb-1 text-center md:text-left"
      >
        Featured Book
      </div>
      <div
        class="text-xs font-bold text-[var(--color-brand-primary)] mb-2 tracking-wide text-center md:text-left uppercase"
      >
        {{ book.genres[0] || "Fiction" }}
      </div>
      <h1
        class="text-3xl font-brand text-[var(--color-brand-primary)] mb-1 text-center md:text-left"
      >
        {{ book.title }}
      </h1>
      <div
        class="text-sm font-bold text-[var(--color-text-muted)] mb-1 text-center md:text-left"
      >
        {{ book.authorName }}
      </div>
      <div
        class="text-xs text-[var(--color-text-muted)] mb-2 text-center md:text-left"
      >
        {{ book.pages }} Pages â€¢ {{ book.createdAt | date : "mediumDate" }}
      </div>
      <div
        class="italic text-[var(--color-text-heading)] text-sm mb-2 text-center md:text-left"
      >
        {{ book.description | slice : 0 : 150
        }}{{ book.description.length > 150 ? "..." : "" }}
      </div>
    </div>
    <div
      class="text-sm text-[var(--color-text-default)] leading-relaxed mb-2 text-center md:text-left w-full"
    >
      {{ book.description }}
    </div>
    <div
      class="flex flex-col sm:flex-row sm:items-center gap-6 mb-2 w-full justify-center md:justify-start"
    >
      <div class="flex flex-col items-center sm:items-start w-full sm:w-auto">
        <div class="text-xs text-[var(--color-text-muted)] mb-1">
          {{ book.pages }} pages total
        </div>
        <div class="text-xs text-[var(--color-text-muted)]">
          Available for purchase
        </div>
      </div>
      <div
        class="flex flex-col items-center sm:items-start sm:ml-8 w-full sm:w-auto"
      >
        <div class="text-lg font-brand text-[var(--color-brand-primary)]">
          {{ book.title }}
        </div>
        <div class="flex items-center gap-1 text-yellow-400">
          <ng-container *ngFor="let star of [1, 2, 3, 4, 5]; let i = index">
            <span
              class="text-xl"
              [ngClass]="{
                'text-yellow-400': i < book.ratingAverage,
                'text-[var(--color-background-medium)]': i >= book.ratingAverage
              }"
              >&#9733;</span
            >
          </ng-container>
          <span class="text-sm text-[var(--color-text-muted)] ml-1"
            >({{ book.ratingQuantity }} reviews)</span
          >
        </div>
      </div>
    </div>
    <div
      class="flex flex-col sm:flex-row gap-4 items-center sm:items-center mb-2 w-full justify-center md:justify-start"
    >
      <button
        (click)="onAddToCart()"
        [disabled]="isAddingToCart || (book && book.stock === 0)"
        [ngClass]="{
          'bg-[var(--color-brand-primary)] text-[var(--color-on-dark)] hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md':
            !isAddingToCart && !addToCartSuccess && book && book.stock > 0,
          'bg-[var(--color-background-medium)] text-[var(--color-brand-primary)] cursor-wait':
            isAddingToCart,
          'bg-[var(--color-brand-primary)] text-[var(--color-on-dark)] shadow-xl scale-105':
            addToCartSuccess,
          'bg-[var(--color-background-dark)] text-[var(--color-text-muted)] cursor-not-allowed opacity-60':
            book && book.stock === 0
        }"
        class="relative overflow-hidden cursor-pointer flex items-center gap-2 font-semibold px-6 py-2 rounded-lg shadow-md transition-all duration-500 ease-out w-full sm:w-auto justify-center transform focus:outline-none focus:ring-2 focus:ring-[var(--color-brand-primary)] focus:ring-offset-2 disabled:cursor-not-allowed"
      >
        <!-- Shimmer effect overlay -->
        <div
          [ngClass]="{ 'animate-pulse': addToCartSuccess }"
          class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full transition-transform duration-700"
          [class.translate-x-full]="addToCartSuccess"
        ></div>

        <span
          [ngClass]="{
            'opacity-0': isAddingToCart || addToCartSuccess,
            'opacity-100': !isAddingToCart && !addToCartSuccess
          }"
          class="transition-opacity duration-300 relative z-10"
        >
          <span *ngIf="book && book.stock > 0"
            >Add to Cart - ${{ book.price }}</span
          >
          <span *ngIf="book && book.stock === 0">Out of Stock</span>
        </span>

        <!-- Loading state -->
        <div
          [ngClass]="{
            'opacity-100': isAddingToCart,
            'opacity-0': !isAddingToCart
          }"
          class="absolute flex items-center gap-2 transition-opacity duration-300 z-10"
        >
          <div
            class="animate-spin w-4 h-4 border-2 border-current border-t-transparent rounded-full"
          ></div>
          <span class="animate-pulse">Adding to Cart...</span>
        </div>

        <!-- Success state -->
        <div
          [ngClass]="{
            'opacity-100': addToCartSuccess,
            'opacity-0': !addToCartSuccess
          }"
          class="absolute flex items-center gap-2 transition-opacity duration-500 z-10"
        >
          <svg
            class="w-5 h-5 animate-bounce"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span class="font-bold animate-pulse">Added to Cart!</span>
        </div>

        <!-- Default cart icon -->
        <svg
          [ngClass]="{
            'opacity-0': isAddingToCart || addToCartSuccess,
            'opacity-100': !isAddingToCart && !addToCartSuccess
          }"
          class="w-5 h-5 transition-opacity duration-300 relative z-10"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5-6m0 0h13M17 13v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6"
          />
        </svg>
      </button>
      <div class="flex flex-col items-center sm:items-start">
        <div class="text-sm text-[var(--color-text-muted)]">
          In Stock: {{ book.stock }} copies
        </div>
        <div class="text-xs text-[var(--color-text-muted)]">
          Free shipping available
        </div>
      </div>
    </div>
    <div
      class="flex flex-wrap gap-2 mb-2 justify-center md:justify-start w-full"
    >
      <span class="font-bold text-[var(--color-text-muted)] mr-2">GENRES:</span>
      <span
        *ngFor="let genre of book.genres"
        class="bg-[var(--color-background-medium)] text-[var(--color-brand-primary)] px-3 py-1 rounded-full text-xs font-medium"
        >{{ genre }}</span
      >
    </div>
    <div
      class="flex flex-wrap gap-8 items-center mt-2 justify-center md:justify-start w-full"
    ></div>
  </div>
  @if (errorMessage){
  <div
    class="fixed inset-0 bg-[rgba(var(--color-background-light-rgb),0.9)] flex items-center justify-center z-50"
  >
    <div
      class="bg-medium p-6 rounded-lg max-w-md w-full mx-4 border border-custom shadow-lg animate-fade-in"
    >
      <!-- Error icon -->
      <div class="flex justify-center mb-4">
        <div class="relative w-16 h-16">
          <div
            class="absolute inset-0 rounded-full bg-brand-primary opacity-20"
          ></div>
          <div
            class="absolute inset-4 flex items-center justify-center text-brand-primary"
          >
            <i class="fas fa-exclamation text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- Error message (optional) -->
      <p class="text-center text-brand-primary mb-6">
        {{ errorMessage }}
      </p>

      <!-- Action buttons -->
      <div class="text-end">
        <button
          (click)="errorMessage = ''"
          class="py-2 px-4 bg-brand-primary text-on-dark rounded hover:opacity-90 transition-opacity cursor-pointer"
        >
          Continue
        </button>
      </div>
    </div>
  </div>
  }
</section>
