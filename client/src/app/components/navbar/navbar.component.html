<nav
  class="sticky top-0 z-50 bg-[var(--color-background-light)] text-[var(--color-text-default)] shadow-lg border-b border-[var(--color-border)] font-secondary"
>
  <!-- Main navbar container -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex h-16 items-center justify-between">
      <!-- Logo/Brand -->
      <div class="flex-shrink-0">
        <a
          routerLink=""
          class="cursor-pointer font-brand text-2xl sm:text-3xl text-[var(--color-text-heading)] hover:opacity-80 transition-opacity"
          (click)="closeMobileMenu()"
          >oceanlibrary</a
        >
      </div>

      <!-- Desktop Search (hidden on mobile) -->
      <div class="hidden md:flex flex-1 max-w-2xl mx-6 lg:mx-8">
        <app-autocomplete-search
          placeholder="Search books by title or author..."
          [showCtrlKIndicator]="true"
          (searchSelected)="onSearchSelected($event)"
          (suggestionSelected)="onSuggestionSelected($event)"
          class="w-full"
        ></app-autocomplete-search>
      </div>

      <!-- Mobile menu button -->
      <div class="md:hidden">
        <button
          type="button"
          (click)="toggleMobileMenu()"
          class="relative inline-flex items-center justify-center rounded-md p-2 text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[var(--color-brand-primary)] transition-colors duration-200"
          aria-expanded="false"
          [attr.aria-expanded]="mobileMenuOpen"
        >
          <span class="sr-only">Open main menu</span>
          <!-- Hamburger icon -->
          <lucide-icon
            [img]="mobileMenuOpen ? X : Menu"
            class="h-6 w-6"
            [class.rotate-180]="mobileMenuOpen"
            style="transition: transform 0.2s ease-in-out"
          ></lucide-icon>
        </button>
      </div>

      <!-- Desktop Navigation Links -->
      <div class="hidden md:flex items-center space-x-4 lg:space-x-6">
        <!-- Nav Icons -->
        <div class="flex items-center space-x-3 lg:space-x-5">
          <a
            routerLink=""
            [class]="getNavLinkClass('')"
            tabindex="0"
            (click)="closeMobileMenu()"
          >
            <lucide-icon
              [img]="Home"
              class="nav-icon h-5 w-5 lg:h-6 lg:w-6 mb-1"
            ></lucide-icon>
            <span class="nav-text text-xs hidden lg:block">Home</span>
          </a>
          <a
            routerLink="browse"
            [class]="getNavLinkClass('browse')"
            tabindex="0"
            (click)="closeMobileMenu()"
          >
            <lucide-icon
              [img]="Compass"
              class="nav-icon h-5 w-5 lg:h-6 lg:w-6 mb-1"
            ></lucide-icon>
            <span class="nav-text text-xs hidden lg:block">Browse</span>
          </a>
          <a
            routerLink="cart"
            [class]="getNavLinkClass('cart')"
            tabindex="0"
            (click)="closeMobileMenu()"
          >
            <lucide-icon
              [img]="ShoppingCart"
              class="nav-icon h-5 w-5 lg:h-6 lg:w-6 mb-1"
            ></lucide-icon>
            <span class="nav-text text-xs hidden lg:block">Cart</span>
          </a>
          <a
            routerLink="admin"
            [class]="getNavLinkClass('admin')"
            tabindex="0"
            (click)="closeMobileMenu()"
            *ngIf="isAdmin"
          >
            <lucide-icon
              [img]="Settings"
              class="nav-icon h-5 w-5 lg:h-6 lg:w-6 mb-1"
            ></lucide-icon>
            <span class="nav-text text-xs hidden lg:block">Admin</span>
          </a>

          <!-- Theme Toggle -->
          <div
            class="nav-link cursor-pointer flex flex-col items-center text-[var(--color-text-muted)] hover:text-[var(--color-brand-primary)] transition-all duration-200 px-2 py-1"
          >
            <button
              (click)="toggleDarkMode()"
              class="theme-toggle relative inline-flex items-center justify-center w-10 h-6 lg:w-12 lg:h-7 rounded-full transition-all duration-300 focus:outline-none"
              [class.active]="isDarkMode"
              [attr.aria-label]="
                isDarkMode ? 'Switch to light mode' : 'Switch to dark mode'
              "
              [title]="
                isDarkMode ? 'Switch to light mode' : 'Switch to dark mode'
              "
            >
              <span
                class="theme-toggle-slider absolute left-1 flex w-4 h-4 lg:w-5 lg:h-5 rounded-full transition-all duration-300 transform items-center justify-center"
                [class]="
                  isDarkMode
                    ? 'translate-x-4 lg:translate-x-5'
                    : 'translate-x-0'
                "
              >
                <lucide-icon
                  [img]="isDarkMode ? Moon : Sun"
                  class="theme-icon w-2.5 h-2.5 lg:w-3 lg:h-3 text-[var(--color-background-dark)]"
                ></lucide-icon>
              </span>
            </button>
            <span class="nav-text text-xs hidden lg:block mt-1">Theme</span>
          </div>
        </div>

        <!-- Auth Section -->
        <div class="flex items-center gap-2 lg:gap-3 ml-4" *ngIf="!isLoggedIn">
          <a
            routerLink="/login"
            class="px-3 py-2 lg:px-4 lg:py-2 rounded-lg font-semibold text-sm text-[var(--color-text-default)] bg-[var(--color-background-light)] border border-[var(--color-border)] hover:bg-[var(--color-background-medium)] hover:border-[var(--color-brand-primary)] transition-all duration-200 shadow-sm"
            (click)="closeMobileMenu()"
          >
            Login
          </a>
          <a
            routerLink="/register"
            class="px-3 py-2 lg:px-4 lg:py-2 rounded-lg font-semibold text-sm bg-[var(--color-background-dark)] text-[var(--color-text-default)] hover:bg-[var(--color-border)] hover:shadow-md transition-all duration-200 shadow-sm"
            (click)="closeMobileMenu()"
          >
            Register
          </a>
        </div>

        <!-- Profile Menu -->
        <div class="relative group ml-4" tabindex="0" *ngIf="isLoggedIn">
          <button
            type="button"
            (click)="profileMenuOpen = !profileMenuOpen"
            (keydown)="onProfileButtonKeydown($event)"
            class="nav-link cursor-pointer focus:outline-none focus:ring-2 focus:ring-[var(--color-brand-primary)] focus:ring-offset-2 rounded-lg"
            [attr.aria-expanded]="profileMenuOpen"
            aria-haspopup="true"
            aria-label="User menu"
          >
            <span class="flex items-center">
              <div
                class="flex items-center space-x-2 px-3 py-2 rounded-lg border-2 border-transparent group-hover:border-[var(--color-brand-primary)] transition-all duration-200 hover:shadow-md hover:bg-[var(--color-background-medium)]"
                [class.border-[var(--color-brand-primary)]]="profileMenuOpen"
                [class.bg-[var(--color-background-medium)]]="profileMenuOpen"
              >
                <lucide-icon
                  [img]="User"
                  class="h-5 w-5 lg:h-6 lg:w-6 text-[var(--color-brand-primary)] transition-transform duration-200"
                  [class.scale-110]="profileMenuOpen"
                ></lucide-icon>
                <span
                  class="text-sm lg:text-base font-medium text-[var(--color-text-default)] hidden sm:block transition-colors duration-200"
                >
                  <span *ngIf="currentUser?.username; else loadingUsername">{{
                    currentUser?.username
                  }}</span>
                  <ng-template #loadingUsername>
                    <span
                      class="inline-block w-16 h-4 bg-[var(--color-background-medium)] rounded animate-pulse"
                    ></span>
                  </ng-template>
                </span>
              </div>
              <lucide-icon
                [img]="ChevronDown"
                class="ml-2 h-4 w-4 lg:h-5 lg:w-5 text-[var(--color-text-muted)] transition-transform duration-200"
                [class.rotate-180]="profileMenuOpen"
              ></lucide-icon>
            </span>
          </button>

          <!-- Enhanced Dropdown Menu -->
          <div
            *ngIf="profileMenuOpen"
            class="dropdown-menu-responsive absolute right-0 mt-2 w-56 bg-[var(--color-background-light)] border border-[var(--color-border)] rounded-2xl shadow-2xl z-30 overflow-hidden backdrop-blur-sm animate-fade-in dropdown-shadow"
          >
            <!-- Dropdown Arrow -->
            <div
              class="absolute -top-2 right-6 w-4 h-4 bg-[var(--color-background-light)] border-l border-t border-[var(--color-border)] transform rotate-45"
            ></div>

            <!-- User Info Header -->
            <div
              class="px-4 py-3 bg-gradient-to-r from-[var(--color-brand-primary)]/5 to-[var(--color-brand-secondary)]/5 border-b border-[var(--color-border)]"
            >
              <div class="flex items-center space-x-3">
                <div
                  class="w-8 h-8 bg-[var(--color-brand-primary)] rounded-full flex items-center justify-center"
                >
                  <lucide-icon
                    [img]="User"
                    class="h-4 w-4 text-white"
                  ></lucide-icon>
                </div>
                <div class="flex-1 min-w-0">
                  <p
                    class="text-sm font-semibold text-[var(--color-text-default)] truncate"
                  >
                    <span *ngIf="currentUser?.username; else loadingName">{{
                      currentUser?.username
                    }}</span>
                    <ng-template #loadingName>
                      <span
                        class="inline-block w-20 h-4 bg-[var(--color-background-medium)] rounded animate-pulse"
                      ></span>
                    </ng-template>
                  </p>
                  <p class="text-xs text-[var(--color-text-muted)] truncate">
                    <span *ngIf="currentUser?.email; else loadingEmail">{{
                      currentUser?.email
                    }}</span>
                    <ng-template #loadingEmail>
                      <span
                        class="inline-block w-24 h-3 bg-[var(--color-background-medium)] rounded animate-pulse"
                      ></span>
                    </ng-template>
                  </p>
                </div>
              </div>
            </div>

            <!-- Menu Items -->
            <div class="py-2">
              <a
                routerLink="/profile"
                class="group flex items-center px-4 py-3 text-sm text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] transition-all duration-200 border-l-2 border-transparent hover:border-[var(--color-brand-primary)]"
                (click)="profileMenuOpen = false; closeMobileMenu()"
              >
                <div
                  class="w-8 h-8 rounded-lg bg-[var(--color-background-medium)] group-hover:bg-[var(--color-brand-primary)]/10 flex items-center justify-center mr-3 transition-colors duration-200"
                >
                  <lucide-icon
                    [img]="User"
                    class="h-4 w-4 text-[var(--color-text-muted)] group-hover:text-[var(--color-brand-primary)] transition-colors duration-200"
                  ></lucide-icon>
                </div>
                <div>
                  <div class="font-medium">Profile</div>
                  <div
                    class="text-xs text-[var(--color-text-muted)] group-hover:text-[var(--color-brand-primary)]/70"
                  >
                    Manage your account
                  </div>
                </div>
              </a>

              <a
                routerLink="/orders"
                class="group flex items-center px-4 py-3 text-sm text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] transition-all duration-200 border-l-2 border-transparent hover:border-[var(--color-brand-primary)]"
                (click)="navigateToOrders()"
              >
                <div
                  class="w-8 h-8 rounded-lg bg-[var(--color-background-medium)] group-hover:bg-[var(--color-brand-primary)]/10 flex items-center justify-center mr-3 transition-colors duration-200"
                >
                  <lucide-icon
                    [img]="Package"
                    class="h-4 w-4 text-[var(--color-text-muted)] group-hover:text-[var(--color-brand-primary)] transition-colors duration-200"
                  ></lucide-icon>
                </div>
                <div>
                  <div class="font-medium">Orders</div>
                  <div
                    class="text-xs text-[var(--color-text-muted)] group-hover:text-[var(--color-brand-primary)]/70"
                  >
                    View order history
                  </div>
                </div>
              </a>

              <!-- Divider -->
              <div
                class="my-2 mx-4 border-t border-[var(--color-border)]"
              ></div>

              <button
                type="button"
                class="group w-full text-left flex items-center px-4 py-3 text-sm text-[var(--color-text-default)] hover:bg-red-50 hover:text-red-600 transition-all duration-200 border-l-2 border-transparent hover:border-red-500 bg-transparent border-0 outline-none"
                (click)="signOut(); profileMenuOpen = false"
              >
                <div
                  class="w-8 h-8 rounded-lg bg-[var(--color-background-medium)] group-hover:bg-red-50 flex items-center justify-center mr-3 transition-colors duration-200"
                >
                  <lucide-icon
                    [img]="LogOut"
                    class="h-4 w-4 text-[var(--color-text-muted)] group-hover:text-red-600 transition-colors duration-200"
                  ></lucide-icon>
                </div>
                <div>
                  <div class="font-medium group-hover:text-red-600">
                    Sign Out
                  </div>
                  <div
                    class="text-xs text-[var(--color-text-muted)] group-hover:text-red-500"
                  >
                    End your session
                  </div>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile menu overlay and content -->
  <div
    *ngIf="mobileMenuOpen"
    class="md:hidden fixed top-16 inset-x-0 bottom-0 z-40 bg-black bg-opacity-50 backdrop-blur-sm animate-fade-in"
    (click)="closeMobileMenu()"
  ></div>

  <!-- Mobile menu panel -->
  <div
    *ngIf="mobileMenuOpen"
    class="md:hidden absolute top-16 left-0 right-0 z-50 bg-[var(--color-background-light)] border-b border-[var(--color-border)] shadow-xl animate-slide-down"
  >
    <div class="px-4 py-6 space-y-6">
      <!-- Mobile Search -->
      <div class="px-2">
        <app-autocomplete-search
          placeholder="Search books by title or author..."
          [showCtrlKIndicator]="false"
          (searchSelected)="onSearchSelected($event)"
          (suggestionSelected)="onSuggestionSelected($event)"
          class="w-full"
        ></app-autocomplete-search>
      </div>

      <!-- Mobile Navigation Links -->
      <div class="space-y-4 px-2">
        <a
          routerLink=""
          [class]="getMobileNavLinkClass('')"
          (click)="closeMobileMenu()"
        >
          <lucide-icon [img]="Home" class="h-6 w-6 mr-3"></lucide-icon>
          <span class="text-lg font-medium">Home</span>
        </a>
        <a
          routerLink="browse"
          [class]="getMobileNavLinkClass('browse')"
          (click)="closeMobileMenu()"
        >
          <lucide-icon [img]="Compass" class="h-6 w-6 mr-3"></lucide-icon>
          <span class="text-lg font-medium">Browse</span>
        </a>
        <a
          routerLink="cart"
          [class]="getMobileNavLinkClass('cart')"
          (click)="closeMobileMenu()"
        >
          <lucide-icon [img]="ShoppingCart" class="h-6 w-6 mr-3"></lucide-icon>
          <span class="text-lg font-medium">Cart</span>
        </a>
        <a
          routerLink="admin"
          [class]="getMobileNavLinkClass('admin')"
          (click)="closeMobileMenu()"
          *ngIf="isAdmin"
        >
          <lucide-icon [img]="Settings" class="h-6 w-6 mr-3"></lucide-icon>
          <span class="text-lg font-medium">Admin Panel</span>
        </a>

        <!-- Mobile Theme Toggle -->
        <div
          class="mobile-theme-toggle flex items-center justify-between px-4 py-3 transition-all duration-200"
        >
          <div class="flex items-center">
            <div
              class="w-10 h-10 rounded-lg bg-[var(--color-brand-primary)]/10 flex items-center justify-center mr-3"
            >
              <lucide-icon
                [img]="isDarkMode ? Moon : Sun"
                class="h-5 w-5 text-[var(--color-brand-primary)]"
              ></lucide-icon>
            </div>
            <div>
              <div class="text-lg font-medium text-[var(--color-text-default)]">
                {{ isDarkMode ? "Dark" : "Light" }} Mode
              </div>
              <div class="text-sm text-[var(--color-text-muted)]">
                {{
                  isDarkMode ? "Switch to light theme" : "Switch to dark theme"
                }}
              </div>
            </div>
          </div>
          <button
            (click)="toggleDarkMode()"
            class="theme-toggle relative inline-flex items-center justify-center w-14 h-8 rounded-full transition-all duration-300 focus:outline-none"
            [class.active]="isDarkMode"
            [attr.aria-label]="
              isDarkMode ? 'Switch to light mode' : 'Switch to dark mode'
            "
          >
            <span
              class="theme-toggle-slider absolute left-1 flex w-6 h-6 rounded-full transition-all duration-300 transform items-center justify-center"
              [class]="isDarkMode ? 'translate-x-6' : 'translate-x-0'"
            >
              <lucide-icon
                [img]="isDarkMode ? Moon : Sun"
                class="theme-icon w-3 h-3 text-[var(--color-background-dark)]"
              ></lucide-icon>
            </span>
          </button>
        </div>
      </div>

      <!-- Mobile Auth Section or Profile -->
      <div class="border-t border-[var(--color-border)] pt-6 px-2">
        <div *ngIf="!isLoggedIn" class="space-y-3">
          <a
            routerLink="/login"
            class="w-full flex items-center justify-center px-4 py-3 rounded-lg font-semibold text-lg text-[var(--color-text-default)] bg-[var(--color-background-light)] border-2 border-[var(--color-border)] hover:bg-[var(--color-background-medium)] hover:border-[var(--color-brand-primary)] transition-all duration-200 shadow-sm"
            (click)="closeMobileMenu()"
          >
            <lucide-icon [img]="LogIn" class="h-5 w-5 mr-2"></lucide-icon>
            Login
          </a>
          <a
            routerLink="/register"
            class="w-full flex items-center justify-center px-4 py-3 rounded-lg font-semibold text-lg bg-[var(--color-background-dark)] text-[var(--color-text-default)] hover:bg-[var(--color-border)] hover:shadow-md transition-all duration-200 shadow-sm"
            (click)="closeMobileMenu()"
          >
            <lucide-icon [img]="UserPlus" class="h-5 w-5 mr-2"></lucide-icon>
            Register
          </a>
        </div>

        <div *ngIf="isLoggedIn" class="space-y-3">
          <!-- Mobile User Profile Header -->
          <div
            class="bg-gradient-to-r from-[var(--color-brand-primary)]/5 to-[var(--color-brand-secondary)]/5 rounded-xl p-4 border border-[var(--color-border)]"
          >
            <div class="flex items-center space-x-3">
              <div
                class="w-10 h-10 bg-[var(--color-brand-primary)] rounded-full flex items-center justify-center"
              >
                <lucide-icon
                  [img]="User"
                  class="h-5 w-5 text-white"
                ></lucide-icon>
              </div>
              <div class="flex-1 min-w-0">
                <p
                  class="text-base font-semibold text-[var(--color-text-default)] truncate"
                >
                  <span *ngIf="currentUser?.username; else loadingMobileName">{{
                    currentUser?.username
                  }}</span>
                  <ng-template #loadingMobileName>
                    <span
                      class="inline-block w-24 h-5 bg-[var(--color-background-medium)] rounded animate-pulse"
                    ></span>
                  </ng-template>
                </p>
                <p class="text-sm text-[var(--color-text-muted)] truncate">
                  <span *ngIf="currentUser?.email; else loadingMobileEmail">{{
                    currentUser?.email
                  }}</span>
                  <ng-template #loadingMobileEmail>
                    <span
                      class="inline-block w-28 h-4 bg-[var(--color-background-medium)] rounded animate-pulse"
                    ></span>
                  </ng-template>
                </p>
              </div>
            </div>
          </div>

          <!-- Mobile Menu Items -->
          <a
            routerLink="/profile"
            class="group w-full flex items-center px-4 py-3 rounded-xl text-lg text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] transition-all duration-200 border-l-4 border-transparent hover:border-[var(--color-brand-primary)]"
            (click)="closeMobileMenu()"
          >
            <div
              class="w-10 h-10 rounded-lg bg-[var(--color-background-medium)] group-hover:bg-[var(--color-brand-primary)]/10 flex items-center justify-center mr-3 transition-colors duration-200"
            >
              <lucide-icon
                [img]="User"
                class="h-5 w-5 text-[var(--color-text-muted)] group-hover:text-[var(--color-brand-primary)] transition-colors duration-200"
              ></lucide-icon>
            </div>
            <div>
              <div class="font-semibold">Profile</div>
              <div
                class="text-sm text-[var(--color-text-muted)] group-hover:text-[var(--color-brand-primary)]/70"
              >
                Manage your account
              </div>
            </div>
          </a>

          <a
            routerLink="/orders"
            class="group w-full flex items-center px-4 py-3 rounded-xl text-lg text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] transition-all duration-200 border-l-4 border-transparent hover:border-[var(--color-brand-primary)]"
            (click)="navigateToOrders()"
          >
            <div
              class="w-10 h-10 rounded-lg bg-[var(--color-background-medium)] group-hover:bg-[var(--color-brand-primary)]/10 flex items-center justify-center mr-3 transition-colors duration-200"
            >
              <lucide-icon
                [img]="Package"
                class="h-5 w-5 text-[var(--color-text-muted)] group-hover:text-[var(--color-brand-primary)] transition-colors duration-200"
              ></lucide-icon>
            </div>
            <div>
              <div class="font-semibold">Orders</div>
              <div
                class="text-sm text-[var(--color-text-muted)] group-hover:text-[var(--color-brand-primary)]/70"
              >
                View order history
              </div>
            </div>
          </a>

          <!-- Mobile Divider -->
          <div class="my-3 mx-4 border-t border-[var(--color-border)]"></div>

          <button
            type="button"
            class="group w-full flex items-center px-4 py-3 rounded-xl text-lg text-[var(--color-text-default)] hover:bg-red-50 hover:text-red-600 transition-all duration-200 border-l-4 border-transparent hover:border-red-500 bg-transparent border-0 outline-none"
            (click)="signOut()"
          >
            <div
              class="w-10 h-10 rounded-lg bg-[var(--color-background-medium)] group-hover:bg-red-50 flex items-center justify-center mr-3 transition-colors duration-200"
            >
              <lucide-icon
                [img]="LogOut"
                class="h-5 w-5 text-[var(--color-text-muted)] group-hover:text-red-600 transition-colors duration-200"
              ></lucide-icon>
            </div>
            <div>
              <div class="font-semibold group-hover:text-red-600">Sign Out</div>
              <div
                class="text-sm text-[var(--color-text-muted)] group-hover:text-red-500"
              >
                End your session
              </div>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>
</nav>
