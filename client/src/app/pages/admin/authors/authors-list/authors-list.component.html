<!-- Authors List Content -->
<div class="authors-list-page">
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Page Header -->
    <div class="mb-8">
      <div
        class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6"
      >
        <div>
          <h1 class="text-4xl font-brand text-[var(--color-text-heading)] mb-2">
            Authors Management
          </h1>
          <p class="text-[var(--color-text-muted)] text-lg">
            Manage your library's author collection
          </p>
        </div>
        <button
          (click)="createNewAuthor()"
          class="inline-flex items-center gap-2 bg-[var(--color-brand-primary)] text-[var(--color-on-dark)] font-semibold px-6 py-3 rounded-lg shadow-lg hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] transition-all duration-200 hover:scale-105 border border-transparent hover:border-[var(--color-brand-primary)]"
        >
          <lucide-icon [img]="Plus" class="h-5 w-5"></lucide-icon>
          Add New Author
        </button>
      </div>

      <!-- Search Section -->
      <div
        class="bg-[var(--color-background-medium)] rounded-xl p-4 shadow-sm mb-6"
      >
        <div class="flex flex-col sm:flex-row gap-3">
          <!-- Search Input with Category Dropdown -->
          <div class="flex-1 flex gap-2">
            <!-- Search Category Dropdown -->
            <div class="relative search-category-dropdown">
              <button
                (click)="
                  showSearchCategoryDropdown = !showSearchCategoryDropdown
                "
                class="flex items-center gap-2 px-3 py-2.5 border border-[var(--color-border)] rounded-lg bg-[var(--color-background-light)] text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] transition-colors whitespace-nowrap"
              >
                {{ getSearchCategoryLabel() }}
                <lucide-icon [img]="ChevronDown" class="h-4 w-4"></lucide-icon>
              </button>

              <!-- Search Category Dropdown Menu -->
              <div
                *ngIf="showSearchCategoryDropdown"
                class="absolute top-full left-0 mt-1 w-40 bg-[var(--color-background-light)] border border-[var(--color-border)] rounded-lg shadow-lg z-50"
              >
                <button
                  (click)="onSearchCategoryChange('name')"
                  class="w-full px-3 py-2 text-left hover:bg-[var(--color-background-medium)] transition-colors"
                  [class.bg-[var(--color-background-medium)]]="
                    searchCategory === 'name'
                  "
                >
                  Name
                </button>
                <button
                  (click)="onSearchCategoryChange('nationality')"
                  class="w-full px-3 py-2 text-left hover:bg-[var(--color-background-medium)] transition-colors"
                  [class.bg-[var(--color-background-medium)]]="
                    searchCategory === 'nationality'
                  "
                >
                  Nationality
                </button>
                <button
                  (click)="onSearchCategoryChange('genres')"
                  class="w-full px-3 py-2 text-left hover:bg-[var(--color-background-medium)] transition-colors rounded-b-lg"
                  [class.bg-[var(--color-background-medium)]]="
                    searchCategory === 'genres'
                  "
                >
                  Genres
                </button>
              </div>
            </div>

            <!-- Search Input -->
            <div class="flex-1">
              <div class="relative">
                <input
                  type="text"
                  [placeholder]="getSearchPlaceholder()"
                  (input)="onSearchInput($event)"
                  [value]="searchTerm"
                  class="w-full pl-12 pr-4 py-2.5 border border-[var(--color-border)] rounded-lg bg-[var(--color-background-light)] text-[var(--color-text-default)] placeholder-[var(--color-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--color-brand-primary)] focus:border-transparent"
                />
                <lucide-icon
                  [img]="Search"
                  class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-[var(--color-text-muted)]"
                ></lucide-icon>
              </div>
            </div>
          </div>

          <!-- Sort Dropdown -->
          <div class="relative sort-dropdown">
            <button
              (click)="showSortDropdown = !showSortDropdown"
              class="flex items-center gap-2 px-4 py-2.5 border border-[var(--color-border)] rounded-lg bg-[var(--color-background-light)] text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] transition-colors whitespace-nowrap"
            >
              <lucide-icon [img]="ArrowUpDown" class="h-4 w-4"></lucide-icon>
              {{ getSortLabel() }}
              <lucide-icon [img]="ChevronDown" class="h-4 w-4"></lucide-icon>
            </button>

            <!-- Sort Dropdown Menu -->
            <div
              *ngIf="showSortDropdown"
              class="absolute top-full right-0 mt-1 w-48 bg-[var(--color-background-light)] border border-[var(--color-border)] rounded-lg shadow-lg z-50"
            >
              <button
                (click)="setSortBy(SortBy.NAME)"
                class="w-full px-3 py-2 text-left hover:bg-[var(--color-background-medium)] transition-colors flex items-center justify-between"
                [class.bg-[var(--color-background-medium)]]="
                  sortBy === SortBy.NAME
                "
              >
                Name
                <span *ngIf="sortBy === SortBy.NAME">{{
                  sortOrder === "asc" ? "↑" : "↓"
                }}</span>
              </button>
              <button
                (click)="setSortBy(SortBy.NATIONALITY)"
                class="w-full px-3 py-2 text-left hover:bg-[var(--color-background-medium)] transition-colors flex items-center justify-between"
                [class.bg-[var(--color-background-medium)]]="
                  sortBy === SortBy.NATIONALITY
                "
              >
                Nationality
                <span *ngIf="sortBy === SortBy.NATIONALITY">{{
                  sortOrder === "asc" ? "↑" : "↓"
                }}</span>
              </button>
              <button
                (click)="setSortBy(SortBy.CREATED_AT)"
                class="w-full px-3 py-2 text-left hover:bg-[var(--color-background-medium)] transition-colors rounded-b-lg flex items-center justify-between"
                [class.bg-[var(--color-background-medium)]]="
                  sortBy === SortBy.CREATED_AT
                "
              >
                Date Created
                <span *ngIf="sortBy === SortBy.CREATED_AT">{{
                  sortOrder === "asc" ? "↑" : "↓"
                }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Stats -->
        <div
          class="mt-3 flex items-center gap-4 text-sm text-[var(--color-text-muted)]"
        >
          <span>Total Authors: {{ totalItems }}</span>
          <span>Page {{ currentPage }} of {{ totalPages }}</span>
          <span *ngIf="searchTerm">
            Searching in {{ getSearchCategoryLabel().toLowerCase() }} for "{{
              searchTerm
            }}"
          </span>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center py-12">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--color-brand-primary)]"
      ></div>
    </div>

    <!-- Authors Grid -->
    <div
      *ngIf="!loading && authors.length > 0"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8"
    >
      <div
        *ngFor="let author of authors"
        class="bg-[var(--color-background-light)] rounded-lg shadow-sm border border-[var(--color-border)] overflow-hidden hover:shadow-md transition-all duration-200"
      >
        <!-- Author Image -->
        <div
          class="aspect-square w-full overflow-hidden bg-[var(--color-background-medium)]"
        >
          <img
            [src]="author.photo"
            [alt]="author.name"
            class="w-full h-full object-cover"
            (error)="handleImageError($event)"
          />
        </div>

        <!-- Author Info -->
        <div class="p-4">
          <h3
            class="font-semibold text-[var(--color-text-heading)] text-lg mb-1 truncate"
          >
            {{ author.name }}
          </h3>

          <p
            *ngIf="author.nationality"
            class="text-[var(--color-text-muted)] text-sm mb-2"
          >
            {{ author.nationality }}
          </p>

          <div *ngIf="author.genres && author.genres.length > 0" class="mb-3">
            <div class="flex flex-wrap gap-1">
              <span
                *ngFor="let genre of author.genres.slice(0, 3)"
                class="inline-block px-2 py-1 text-xs bg-[var(--color-background-medium)] text-[var(--color-text-muted)] rounded"
              >
                {{ genre }}
              </span>
              <span
                *ngIf="author.genres.length > 3"
                class="inline-block px-2 py-1 text-xs bg-[var(--color-background-medium)] text-[var(--color-text-muted)] rounded"
              >
                +{{ author.genres.length - 3 }}
              </span>
            </div>
          </div>

          <p
            *ngIf="author.bio"
            class="text-[var(--color-text-muted)] text-sm line-clamp-2 mb-3"
          >
            {{ author.bio }}
          </p>

          <!-- Action Buttons -->
          <div class="flex gap-2">
            <button
              (click)="editAuthor(author._id)"
              class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 text-sm bg-[var(--color-brand-primary)] text-[var(--color-on-dark)] rounded-lg hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] border border-transparent hover:border-[var(--color-brand-primary)] transition-all duration-200"
            >
              <lucide-icon [img]="Edit" class="h-4 w-4"></lucide-icon>
              Edit
            </button>
            <button
              (click)="confirmDeleteAuthor(author)"
              class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all duration-200"
            >
              <lucide-icon [img]="Trash2" class="h-4 w-4"></lucide-icon>
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && authors.length === 0" class="text-center py-12">
      <lucide-icon
        [img]="User"
        class="h-16 w-16 text-[var(--color-text-muted)] mx-auto mb-4"
      ></lucide-icon>
      <h3 class="text-xl font-semibold text-[var(--color-text-heading)] mb-2">
        {{ searchTerm ? "No authors found" : "No authors yet" }}
      </h3>
      <p class="text-[var(--color-text-muted)] mb-6">
        {{
          searchTerm
            ? "Try adjusting your search terms."
            : "Start by adding your first author to the library."
        }}
      </p>
      <button
        *ngIf="!searchTerm"
        (click)="createNewAuthor()"
        class="inline-flex items-center gap-2 bg-[var(--color-brand-primary)] text-[var(--color-on-dark)] font-semibold px-6 py-3 rounded-lg shadow-lg hover:bg-[var(--color-background-medium)] hover:text-[var(--color-brand-primary)] transition-all duration-200 border border-transparent hover:border-[var(--color-brand-primary)]"
      >
        <lucide-icon [img]="Plus" class="h-5 w-5"></lucide-icon>
        Add First Author
      </button>
    </div>

    <!-- Pagination -->
    <div
      *ngIf="!loading && totalPages > 1"
      class="flex justify-center items-center gap-2 mt-8"
    >
      <button
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage <= 1"
        class="inline-flex items-center gap-1 px-3 py-2 border border-[var(--color-border)] rounded-lg text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <lucide-icon [img]="ChevronLeft" class="h-4 w-4"></lucide-icon>
        Previous
      </button>

      <div class="flex gap-1">
        <ng-container *ngFor="let page of getPaginationArray()">
          <button
            *ngIf="page > 0"
            (click)="onPageChange(page)"
            [class]="
              page === currentPage
                ? 'bg-[var(--color-brand-primary)] text-[var(--color-on-dark)]'
                : 'bg-[var(--color-background-medium)] text-[var(--color-text-default)] hover:bg-[var(--color-brand-primary)] hover:text-[var(--color-on-dark)]'
            "
            class="w-10 h-10 rounded-lg border border-[var(--color-border)] transition-colors font-semibold"
          >
            {{ page }}
          </button>
          <span
            *ngIf="page === -1"
            class="w-10 h-10 rounded-lg border border-[var(--color-border)] bg-[var(--color-background-medium)] text-[var(--color-text-muted)] flex items-center justify-center font-semibold"
          >
            ...
          </span>
        </ng-container>
      </div>

      <button
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage >= totalPages"
        class="inline-flex items-center gap-1 px-3 py-2 border border-[var(--color-border)] rounded-lg text-[var(--color-text-default)] hover:bg-[var(--color-background-medium)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Next
        <lucide-icon [img]="ChevronRight" class="h-4 w-4"></lucide-icon>
      </button>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div
    *ngIf="showDeleteModal"
    class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"
    (click)="$event.target === $event.currentTarget && cancelDelete()"
  >
    <div
      class="bg-[var(--color-background-light)] rounded-lg shadow-xl max-w-md w-full p-6"
    >
      <div class="flex items-center gap-4 mb-4">
        <div class="flex-shrink-0">
          <lucide-icon
            [img]="AlertTriangle"
            class="h-8 w-8 text-red-500"
          ></lucide-icon>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-[var(--color-text-heading)]">
            Delete Author
          </h3>
          <p class="text-[var(--color-text-muted)] mt-1">
            Are you sure you want to delete "{{ authorToDelete?.name }}"? This
            action cannot be undone.
          </p>
        </div>
      </div>

      <div class="flex gap-3 justify-end">
        <button
          (click)="cancelDelete()"
          class="px-4 py-2 text-sm font-medium text-[var(--color-text-default)] bg-[var(--color-background-medium)] border border-[var(--color-border)] rounded-lg hover:bg-[var(--color-background-dark)] transition-colors"
        >
          Cancel
        </button>
        <button
          (click)="deleteAuthor()"
          class="px-4 py-2 text-sm font-medium text-white bg-red-500 border border-red-500 rounded-lg hover:bg-red-600 transition-colors"
        >
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Error Modal -->
  <app-error-modal
    *ngIf="showErrorModal"
    [isVisible]="showErrorModal"
    [title]="errorModalTitle"
    [message]="errorModalMessage"
    [showActionButton]="errorModalShowAction"
    [actionButtonText]="errorModalActionText"
    (action)="onErrorModalAction()"
    (close)="onErrorModalClose()"
  ></app-error-modal>
</div>
