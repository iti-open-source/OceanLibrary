<div
  class="min-h-screen bg-[var(--color-background-light)] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"
>
  <div class="max-w-md w-full space-y-8">
    <!-- Header -->
    <div class="text-center">
      <div class="flex justify-center mb-6">
        <div
          class="w-20 h-20 bg-[var(--color-brand-primary)] rounded-full flex items-center justify-center"
        >
          <lucide-icon
            [img]="Lock"
            class="h-10 w-10 text-[var(--color-on-dark)]"
          ></lucide-icon>
        </div>
      </div>
      <h1
        class="text-3xl font-bold text-[var(--color-text-heading)] font-brand"
      >
        Reset Your Password
      </h1>
      <p class="mt-2 text-sm text-[var(--color-text-muted)]">
        Enter your new password below to complete the reset process.
      </p>
    </div>

    <!-- Success State -->
    <div
      *ngIf="passwordReset && !isSubmitting"
      class="bg-green-50 border border-green-200 rounded-xl p-6 text-center"
    >
      <div class="flex justify-center mb-4">
        <lucide-icon
          [img]="CheckCircle"
          class="h-12 w-12 text-green-500"
        ></lucide-icon>
      </div>
      <h3 class="text-lg font-semibold text-green-800 mb-2">
        Password Reset Successful!
      </h3>
      <p class="text-sm text-green-700 mb-4">
        Your password has been successfully reset. You can now log in with your
        new password.
      </p>
      <button
        (click)="goToLogin()"
        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
      >
        Go to Login
      </button>
    </div>

    <!-- Form -->
    <form
      *ngIf="!passwordReset && !tokenExpired"
      [formGroup]="resetPasswordForm"
      (ngSubmit)="onSubmit()"
      class="space-y-6"
    >
      <!-- Error Message -->
      <div
        *ngIf="errorMessage"
        class="bg-red-50 border border-red-200 text-red-700 rounded-lg p-4 flex items-center gap-3"
      >
        <lucide-icon
          [img]="AlertCircle"
          class="h-5 w-5 flex-shrink-0"
        ></lucide-icon>
        <span class="text-sm">{{ errorMessage }}</span>
      </div>

      <!-- New Password Field -->
      <div>
        <label
          for="password"
          class="block text-sm font-medium text-[var(--color-text-default)] mb-2"
        >
          New Password
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <lucide-icon
              [img]="Lock"
              class="h-5 w-5 text-[var(--color-text-muted)]"
            ></lucide-icon>
          </div>
          <input
            id="password"
            [type]="showPassword ? 'text' : 'password'"
            formControlName="password"
            placeholder="Enter your new password"
            class="block w-full pl-10 pr-12 py-3 border rounded-lg bg-[var(--color-background-light)] text-[var(--color-text-default)] placeholder-[var(--color-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--color-brand-primary)] focus:border-transparent transition-colors"
            [class.border-red-300]="isFieldInvalid('password')"
            [class.border-[var(--color-border)]]="!isFieldInvalid('password')"
          />
          <button
            type="button"
            (click)="togglePasswordVisibility()"
            class="absolute inset-y-0 right-0 pr-3 flex items-center"
          >
            <lucide-icon
              [img]="showPassword ? EyeOff : Eye"
              class="h-5 w-5 text-[var(--color-text-muted)] hover:text-[var(--color-text-default)]"
            ></lucide-icon>
          </button>
        </div>
        <div
          *ngIf="isFieldInvalid('password')"
          class="mt-1 text-sm text-red-600"
        >
          {{ getFieldError("password") }}
        </div>
      </div>

      <!-- Confirm Password Field -->
      <div>
        <label
          for="confirmPassword"
          class="block text-sm font-medium text-[var(--color-text-default)] mb-2"
        >
          Confirm New Password
        </label>
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <lucide-icon
              [img]="Lock"
              class="h-5 w-5 text-[var(--color-text-muted)]"
            ></lucide-icon>
          </div>
          <input
            id="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            formControlName="confirmPassword"
            placeholder="Confirm your new password"
            class="block w-full pl-10 pr-12 py-3 border rounded-lg bg-[var(--color-background-light)] text-[var(--color-text-default)] placeholder-[var(--color-text-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--color-brand-primary)] focus:border-transparent transition-colors"
            [class.border-red-300]="isFieldInvalid('confirmPassword')"
            [class.border-[var(--color-border)]]="
              !isFieldInvalid('confirmPassword')
            "
          />
          <button
            type="button"
            (click)="toggleConfirmPasswordVisibility()"
            class="absolute inset-y-0 right-0 pr-3 flex items-center"
          >
            <lucide-icon
              [img]="showConfirmPassword ? EyeOff : Eye"
              class="h-5 w-5 text-[var(--color-text-muted)] hover:text-[var(--color-text-default)]"
            ></lucide-icon>
          </button>
        </div>
        <div
          *ngIf="isFieldInvalid('confirmPassword')"
          class="mt-1 text-sm text-red-600"
        >
          {{ getFieldError("confirmPassword") }}
        </div>
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        [disabled]="resetPasswordForm.invalid || isSubmitting"
        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-[var(--color-on-dark)] bg-[var(--color-brand-primary)] hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--color-brand-primary)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
      >
        <span *ngIf="!isSubmitting">Reset Password</span>
        <span *ngIf="isSubmitting" class="flex items-center gap-2">
          <div
            class="animate-spin rounded-full h-4 w-4 border-b-2 border-[var(--color-on-dark)]"
          ></div>
          Resetting...
        </span>
      </button>
    </form>

    <!-- Token Expired State -->
    <div
      *ngIf="tokenExpired"
      class="bg-red-50 border border-red-200 rounded-xl p-6 text-center"
    >
      <div class="flex justify-center mb-4">
        <lucide-icon
          [img]="AlertCircle"
          class="h-12 w-12 text-red-500"
        ></lucide-icon>
      </div>
      <h3 class="text-lg font-semibold text-red-800 mb-2">Link Expired</h3>
      <p class="text-sm text-red-700 mb-4">
        This password reset link has expired. Please request a new one.
      </p>
      <a
        routerLink="/forgot-password"
        class="inline-block px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
      >
        Request New Link
      </a>
    </div>

    <!-- Back to Login -->
    <div class="text-center">
      <a
        routerLink="/login"
        class="inline-flex items-center gap-2 text-sm text-[var(--color-brand-primary)] hover:opacity-80 transition-colors"
      >
        <lucide-icon [img]="ArrowLeft" class="h-4 w-4"></lucide-icon>
        Back to Login
      </a>
    </div>
  </div>
</div>
