<div
  class="chatbox-container"
  [class.expanded]="isExpanded"
  [class.dark-mode]="isDarkMode"
>
  <!-- Circular icon -->
  <div class="chatbox-icon" (click)="toggleChat()" *ngIf="!isExpanded">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
    >
      <path
        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
      />
    </svg>
  </div>

  <div class="chatbox-header" *ngIf="isExpanded" (click)="toggleChat()">
    <span class="titleicon"
      ><i class="fa-solid fa-robot me-2"></i> AI Reading Companion</span
    >
    <span class="toggle-icon">Ã—</span>
  </div>

  <!-- Expanded chatbox -->
  <div class="chatbox-content" *ngIf="isExpanded">
    <div class="messages-container">
      <div
        *ngFor="let message of messages"
        class="message"
        [class.user]="message.isUser"
        [class.typing]="message.isTyping"
      >
        <p *ngIf="!message.isTyping">{{ message.text }}</p>
        <div *ngIf="message.isTyping" class="typing-indicator">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span class="timestamp" *ngIf="!message.isTyping">
          {{ message.timestamp | date : "shortTime" }}
        </span>
      </div>
    </div>
  </div>
  <div class="input-container fixed-bottom" *ngIf="isExpanded">
    <input
      type="text"
      [(ngModel)]="newMessage"
      placeholder="Type your message..."
      (keyup.enter)="sendMessage()"
      [disabled]="isWaitingForResponse"
    />
    <button
      (click)="sendMessage()"
      class="mx-2"
      [disabled]="isWaitingForResponse || !newMessage.trim()"
    >
      <svg width="20" height="20" viewBox="0 0 24 24">
        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
      </svg>
    </button>
  </div>
</div>
